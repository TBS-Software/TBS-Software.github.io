<!DOCTYPE html>
<html>
<head>
        <meta charset="utf-8">
        <title>Облако точек в OBJ</title>
    <link href="../../_css/rootpage.css" rel="stylesheet">
    </head>
    <body>
        
    <div id="header">
        <center><a href="../index.html" class="nav" alt="Перейти на страницу с публикациями">ВЕРНУТЬСЯ К ПУБЛИКАЦИЯМ</a></center>
        <hr class="hr-two-color">
            
    </div>
        <div id="article">
            
        <h2>Об экспорте облака точек в формат OBJ</h2>
            <h5> Дата публикации: 16 февраля 2021 г.<br> Автор: Егор Гребенюк</h5>

                <center><img src = "../../images/articles/16-02-2021-pointcloud-to-obj/Preview.png" width="500" alt = "Preview photo"></center>
                <p> На одном из форумов недавно прочел о необходимости конвертации облака точек в формат OBJ/FBX. Заинтересовавшись этим, решил посмотреть на возможности имеющегося
                    ПО по конвертации в данные форматы. Не обнаружив ничего как среди действующего ПО, так и среди частных решения на GitHub решил написать свое приложение-конвертер и попытаться разобраться, почему данная программная реализация так непопулярна?
                </p>
                <h3>Зачем это надо?</h3>
                <p>Тематика лазерного сканирования становится популярной год от года по причине большего предложения от фирм производителей сканеров и положительного опыта от инженеров,применяющих данную технологию на производстве. Облака точек,получаемые от сканеров идут напрямуюв отдел моделирования для оцифровки геометрии и создания точной цифровой модели объекта. Но зачастую требуется разместить в веб-среде результат лазерного сканирования для визуального анализа/просмотра. Особенность облака точек - это огромные, малосжимаемые данные высокой плотности, которые для размещения в Web-среде необходимо проредить и максимально снизить вес файла (путем применения сдвижки координат к точкам и зачастую убирая информацию о цвете точек). 
                </p>
                <h3>Какие есть решения?</h3>
                <p>По существу, решения есть от вендоров-производителей софта и некоторых частных платформ. Мы не будем подробно касаться данного вопроса, а рассмотрим больше задачу представления облака точек в формат Wavefront OBJ (универсальное описание 3D геометрии). Единственное, поясним, почему делается акцент на возможность экспорта в нейтральные общеподдерживаемые форматы представления геометрии - именно для возможности использовать открытые инструменты и спецификацию форматов. Спецификация OBJ приведена <a href="http://www.martinreddy.net/gfx/3d/OBJ.spec">тут</a> вместе с <a href="https://www.fileformat.info/format/material/">дополнительной спецификацией</a> для поддержки цветов и материалов. Если обратить внимание на представленную спецификацию, там нет явного элемента отображения для 3D-точки (только для геометрических фигур). При этом вариант представления точки как сферы заданного цвета также не имеет места на реализацию по причине отсутствия в спецификации способов описания сферических тел как одной фигуры (только как совокупности иножества полигональных граней тела).</p>
                
                <h3>Путь реализации программного алгоритма</h3>
                <p>Как можно сделать вывод, я прибегнул к представлении точки как простого геометрического тела (куб, октаэдр и тетраэдр). Сразу сделаю примечание, что ознакомиться с исходным кодом можно <a href="https://github.com/GeorgGrebenyuk/Point-cloud-to-OBJ">в данном репозитории на GitHub</a>. Релизованное на NET Framework 4.8 с использованием WinForms приложение выглядит следующим образом:</p>
                <center><img src= "../../images/articles/16-02-2021-pointcloud-to-obj/View_of_app.png" alt = "App view"></center>
                <center>Рисунок 1 - Вид скомпилированного приложения</center>
                <p>
                Принцип работы довольно простой - происходит считывание текстового файла с точками (вида XYZRGB) с разделителем "пробел", далее точка передается в блок кода в соответствии с выбранным форматом преобразования (куб, октаэдр или тетраэдр), а цвет заносится в MTL файл. При этом как фигуре, так и материалу (цвету) присаивается порядковый номер точки в списке файла точек вида "p1234". Результат работы программы - сформированные 2 файла - файд OBJ и одноименный с ним файл с цветами точек MTL:
                </p>
                <center><img src= "../../images/articles/16-02-2021-pointcloud-to-obj/Result.png" alt = "App view"></center>
                <center>Рисунок 2 - Результат работы приложения</center>
                <p>В качестве среды просмотра можно использовать стандартный инструмент "Просмотр 3D объектов" встроенный в Windows 10 либо загрузить бесплатный инструмент Autodesk FBX Viewer.</p>
                <h3>Выводы по теме</h3>
                <p>Программный путь конвертации облака точек в файл OBJ+MTL может формировать неограниченно большие файлы, однако конечная среда просмотра OBJ файлов не воспринимает высокополигональные объекты (использование N точек приводит к формированию дополнительной геометрии в 8*N (для куба и октаэдра), 4*N (для тетраэдра) раз больше чем число точек N. Опытным путем было установлено, что при числе граней свыше 30000 начинаются фризы, а при числе порядка 50000 файлы может попросту не открыться. На этом можно сделать вывод - что представлять облако точек как геометрические примитивы нецелесообразно. Альтернативный путь - использовать бинарный формат GLB, который как раз поддерживает точку как элемент геометрии и может хранить куда больше элементов без потерь производительности. С данным решением можно ознакомиться <a href="https://github.com/GeorgGrebenyuk/PointCloudToGLTF">по данной ссылке</a> </p>
            
        </div>
        <div id="bottom-side">
            <hr class="hr-two-color">
            <h5>Copyright © TBS-Software, 2020-2021</h5>
        </div>
        </body>
</html>